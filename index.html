<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DHT11 + ON/OFF Control + Message</title>
<style>
  body { font-family: Arial; background: #1e1e1e; color: #fff; text-align:center; padding:50px;}
  button { padding:15px 30px; margin:10px; font-size:18px; cursor:pointer; border:none; border-radius:8px;}
  #on { background-color:#28a745; color:#fff;}
  #off { background-color:#dc3545; color:#fff;}
  #data { margin-top:30px; font-size:22px;}
  input[type=text] { padding:10px; width:200px; border-radius:5px; border:none; margin-right:10px; }
</style>
</head>
<body>

<h1>DHT11 Sensor & Control</h1>

<button id="on">ON</button>
<button id="off">OFF</button>
<br><br>
<input type="text" id="message" placeholder="Type a message">
<button id="sendMsg">Send Message</button>

<div id="data">
  <p>Temperature: <span id="temp">--</span> Â°C</p>
  <p>Humidity: <span id="hum">--</span> %</p>
</div>

<script>
const writeKey = "OPDHX758K8LI4ZJW"; 
const channelID = "3123407";

document.getElementById("on").onclick = () => sendCommand(1);
document.getElementById("off").onclick = () => sendCommand(0);
document.getElementById("sendMsg").onclick = sendMessage;

function sendCommand(value){
  fetch(`https://api.thingspeak.com/update?api_key=${writeKey}&field3=${value}`)
  .then(res => console.log(value==1?"ON sent":"OFF sent"))
  .catch(err => console.log(err));
}

function sendMessage(){
  const msg = document.getElementById("message").value;
  if(msg.trim() == "") return;
  fetch(`https://api.thingspeak.com/update?api_key=${writeKey}&field4=${encodeURIComponent(msg)}`)
  .then(res => console.log("Message sent: " + msg))
  .catch(err => console.log(err));
  document.getElementById("message").value = "";
}

// Fetch DHT data every 5 seconds
function getData(){
  fetch(`https://api.thingspeak.com/channels/${channelID}/fields/1.json?results=1`)
  .then(res=>res.json())
  .then(data=>{
    if(data.feeds && data.feeds.length>0){
      document.getElementById("temp").innerText = data.feeds[0].field1 || "--";
      document.getElementById("hum").innerText = data.feeds[0].field2 || "--";
    }
  }).catch(err=>console.log(err));
}

setInterval(getData,5000);
getData();
</script>

</body>
</html>
